/*
 * grunt-angular-protractor
 * https://github.com/software-engineering/grunt-angular-protractor
 *
 * Copyright (c) 2015 it-schaedler
 * Licensed under the MIT license.
 */

'use strict';
var _ = require('lodash'),
    util = require('util');

module.exports = function (_this, task) {

    // Defaults is overriden by task options
    var options,
        saveData = {};

    if (!task.data.options) {
        _this.grunt.warn('Each Task need options');
    } else {
        saveData = task.data.options;
    }

    if (!_.isUndefined(_this.configFile) && _this.configFile) {
        var configFile = require(_this.configFile).config,
            mergeGruntBuildConfigWithConfigFileAndGruntDefaults = _.defaultsDeep(saveData, configFile),
            options = task.options(mergeGruntBuildConfigWithConfigFileAndGruntDefaults);
    } else {
        _this.grunt.verbose.writeln('Task configFile did not exist. ' + _this.configFile);
        options = task.options(saveData);
    }

    _this.grunt.verbose.writeln("Options: " + util.inspect(options));

    delete options.configFile;
    return options;

};
